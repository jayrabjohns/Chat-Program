when the client starts up it connects to a server to requests list of all friends and their statuses
The server returns a list of friends along with an ID / string for each, and any unsent messages intended for this client.

When the client wants to send a message is attaches the ID / string along with the message, the server will attach the ID of tehe sender and look up the address of that friend and send it.
The client never gets access to the IP addresses of other clients.

Maybe instead of friends, it could be chat rooms, to allow for group chats.

if the friend is offline the server stores the unsent messages.

The server storesa database with a unique ID / string, the account details, unsent messages.

The client will be responsible for storing the rest of the message history.